def notifyObj
node(""){
   env.WORKSPACE=pwd()


   stage("Checkout"){
        dir("ossim-ci") {
            git branch: "${OSSIM_GIT_BRANCH}", url: "https://github.com/ossimlabs/ossim-ci.git"
        }
        dir("omar-opencv3_2") {
            git branch: "${OSSIM_GIT_BRANCH}", url: "https://github.com/ossimlabs/omar-opencv3_2.git"
        }
        notifyObj = load "${workspaceDir}/ossim-ci/jenkins/pipeline/notify.groovy"
   }
   try{
      stage("Build"){
         sh """
             ${env.WORKSPACE}/omar-opencv3_2/scripts/build.sh
         """
      }
   }
   catch(e){
        echo e.toString()
        currentBuild.result = "FAILED"
        notifyObj?.notifyFailed()
    }

  stage("Clean Workspace"){
     step([$class: 'WsCleanup'])
  }
}